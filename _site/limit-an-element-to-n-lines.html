<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>Limit an element to N lines</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description" content="Bec d'état, Rebecca Scott's personal blog"/>
		<meta name="author" content="Rebecca Scott"/>
		<link href="//fonts.googleapis.com/css?family=Cinzel" rel="stylesheet" type="text/css"/>
		<link href="//fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet" type="text/css"/>
		<link href="/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
		<link href="/lib/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet"/>
		<link href="/css/site.css" rel="stylesheet"/>
	</head>
	<body>
		<div class="container">
			<div class="row header">
				<h1><a href="https://becdetat.com">Bec d'état</a></h1>
				<h2><a href="https://becdetat.com">Rebecca Scott's Blog</a></h2>
			</div>
		</div>

		<hr/>

		<div class="container">
			<div class="row content">
				<h1><a href="/">~/</a>Limit an element to N lines <br/></h1>
<h2><small><em>06 Mar 2018</em></small></h2>

<p>HTML layout tips (and jQuery) are sooooo 2008 but you know.</p>

<p>Gotta pay the bills.</p>

<p>So say you want an element to be trimmed responsively so it doesn’t go over <em>n</em> lines with a nice ellipsis. CSS’s <code class="language-plaintext highlighter-rouge">text-overflow</code> won’t cut it because it only works for 1 line (it needs <code class="language-plaintext highlighter-rouge">white-space: nowrap</code>). Plus I really wanted to trim by words, not characters, because <em>reasons</em>.</p>

<p>This code uses jQuery because it’s already in my project, but there’s no reason why this couldn’t be changed to use native DOM methods.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function maintainElementLineCount($el, lineCount) {
  const originalText = $el.text()

  function _inner() {
    $el.text(originalText)

    const words = originalText.split(' ')

    while (words.length) {
      const elLineCount = $el.height() / parseFloat($el.css('line-height'))

      if (elLineCount &lt;= lineCount) return

      words.pop()
      $el.text(words.join(' ') + '...')
    }
  }

  $(window).on('resize', _.throttle(() =&gt; _inner(), 100))
  setTimeout(() =&gt; _inner(), 100)
}
</code></pre></div></div>

<p>It works like so:</p>

<ol>
  <li>copy the original text</li>
  <li>on resize (throttled to 100ms) and 100ms after the function is called, put the original text back in the element, then keep trimming off one word at a time until the height is correct.</li>
</ol>

<p>Basically it just brute forces trimming the text until it’s the correct height. Not especially efficient but it performs well wherever I’ve tested it - I’m starting with short original text so it only usually trims 5 to 10 words at most, and looping through the entire thing is ok. It could be optimised by figuring out if the resize was bigger or smaller, and working in that direction rather than just starting from the original text, which would be recommended if you’re trying to trim lots of text into a small target area. There are also probably edge conditions that make it fall over but I haven’t encountered anything serious.</p>

<p>Note that the height of a single line is taken from the CSS <code class="language-plaintext highlighter-rouge">line-height</code> property. There may be cases where this doesn’t work correctly but our line heights are relatively sane.</p>

<p>This also won’t work if the element’s inner text changes dynamically, as the original text is recorded and closed over by the inner function. Either something would need to watch for changes to the element’s contents, or the handler would need to be detached and set up again manually when changing the inner text.</p>

<p>To make this work using a data attribute (with static markup only as I haven’t needed to use this with dynamic markup yet - I’ll update this post if I ever need it):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$('[data-line-limit]').each(function() {
  const $el = $(this)
  const lineLimit = parseInt($el.data('line-limit'))

  maintainElementLineCount($el, lineLimit)
})
</code></pre></div></div>

<p>For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p id="my_paragraph" data-line-limit="2"&gt;lots of text here&lt;/p&gt;
</code></pre></div></div>



<br/>

<div id="disqus_thread"></div>
<script>
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://becdetat.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

			</div>
		</div>

		<hr/>

		<div class="container">
			<div class="row footer">
				<p><small>
					Content &copy; 2008-2022 Rebecca Scott<br/>
					<a href="https://www.linkedin.com/in/rebecca-scott-b522a418/" target="_blank">LinkedIn</a> |
					<a href="https://github.com/becdetat" target="_blank">GitHub</a> |
					<a href="mailto:me@becdetat.com">me@becdetat.com</a>
				</small></p>
			</div>
		</div>

		<script src="/lib/jquery-2.0.2.min.js"></script>
		<script src="/lib/bootstrap/js/bootstrap.min.js"></script>
		<script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
		<script src="/js/site.js"></script>
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-67018713-1', 'auto');
		  ga('send', 'pageview');
		</script>
	</body>
</html>
