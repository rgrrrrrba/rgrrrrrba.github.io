<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>ORDER BY items must appear in the select list if the statement contains a UNION operator</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description" content="Ben d'état. Ben Scott's personal blog. The site formerly known as Red, Green, Refactor, Red, Red, Red, Revert, Back Away, the site formally known as Belfry Images."/>
		<meta name="author" content="Ben Scott"/>
		<link href="http://fonts.googleapis.com/css?family=Cinzel" rel="stylesheet" type="text/css"/>
		<link href="http://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet" type="text/css"/>
		<link href="/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
		<link href="/lib/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet"/>
		<link href="/css/site.css" rel="stylesheet"/>
	</head>
	<body>
		<div class="container">
			<div class="row header">
				<h1><a href="http://bendetat.com">Ben d'état</a></h1>
				<h2><a href="mailto:ben@swxben.com">Ben Scott</a></h2>
			</div>
		</div>

		<hr/>
		
		<div class="container">		
			<div class="row content">
				<h1><a href="/">~/</a>ORDER BY items must appear in the select list if the statement contains a UNION operator <br/></h1>
<p class="twitter-link"><a href="https://twitter.com/share" class="twitter-share-button" data-via="bendetat">Tweet</a></p>
<h2><small><em>19 Aug 2008</em></small></h2>



<p>Is a very annoying error message that you get when writing above average complexity <code>SELECT</code> statements. I’m not sure if it only applies to queries against SQL Server, but it can be very difficult to debug if you haven’t come across it before (or come across so many things in a day that they all blur into one big problem).</p>

<p>For me at least it happens like this:</p>

<ol>
<li>Ben writes a big meaty query, tests it, all ok</li>
<li>Ben writes query #2, which has the same SELECTed columns as the first query, tests also, also ok</li>
<li>Ben sticks a <code>UNION ALL</code> between the two queries, thus making Das Uberquery&trade; and securing his employment</li>
<li>Ben executes said query and gets cryptic error message, spends rest of day tring to debug 300 lines of SQL, goes home with migraine.</li>
</ol>


<p>It sounds like one of the queries has an <code>ORDER BY</code> clause but of course I’ve taken all of the <code>ORDER BY</code>s out when joining them, and I’m ordering the UNION as a whole!</p>

<p>The issue is that one or more of the big mutha queries that are being UNION ALLed together contain a subquery that contains a <code>ORDER BY</code> clause. Something like this:</p>

<pre><code>SELECT t1.A, t2.B
FROM t1, (SELECT TOP 1 * FROM Foo ORDER BY Bar) t2
UNION ALL
SELECT t3.A, t3.B
FROM t3
</code></pre>

<p>It’s that <code>ORDER BY Bar</code> part that gives grief. I can’t see why it’s an issue, but this is what to look out for. Replace the subquery with a view or find some other way to do it without the <code>ORDER BY</code> clause.</p>




<br/>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bendetat'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


			</div>
		</div>

		<hr/>

		<div class="container">			
			<div class="row footer">
				<p><small>
					Content &copy; 2008-2014 Ben Scott<br/>
					<a href="https://twitter.com/bendetat">@bendetat</a> |
					<a href="mailto:ben@swxben.com">ben@swxben.com</a> |
					<a href="https://github.com/bendetat">github.com/bendetat</a> |
					<a href="http://www.swxben.com">Software by Ben Pty Ltd</a> | <a href="http://www.swxben.com">SWXBEN</a>
				</small></p>
			</div>
		</div>

		<script src="/lib/jquery-2.0.2.min.js"></script>
		<script src="/lib/bootstrap/js/bootstrap.min.js"></script>
		<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
		<script src="/js/site.js"></script>
	</body>
</html>